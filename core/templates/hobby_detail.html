{% extends 'base.html' %}

{% block content %}
<style>
    body { background: #f9daa6ff; }
    .oishii-card {
        background: #fff;
        border-radius: 1.5rem;
        box-shadow: 0 4px 24px rgba(0,0,0,0.07);
        border: none;
        padding: 2rem;
        margin-bottom: 2rem;
    }
    .oishii-title {
        font-family: 'Rounded Mplus 1c', 'Montserrat', 'Playfair Display', Arial, sans-serif;
        font-weight: 900;
        font-size: 2.2rem;
        color: #1820FF;
        margin-bottom: .5em;
        letter-spacing: 1px;
    }
    .oishii-badge {
        display: inline-block;
        padding: .4em 1.2em;
        border-radius: 2em;
        font-size: 1rem;
        font-weight: 700;
        margin-right: .5em;
        margin-bottom: .3em;
        background: #fbeac6ff;
        color: #1820FF;
        border: 2px solid #1820FF;
    }
    .oishii-badge.orange {
        background: #FFE5D0;
        color: #ff4e42;
        border: 2px solid #ff4e42;
    }
    .oishii-badge.yellow {
        background: #FFFCED;
        color: #FFC024;
        border: 2px solid #FFC024;
    }
    .oishii-btn {
        border-radius: 2em;
        font-weight: 700;
        padding: .7em 2em;
        border: none;
        background: #1820FF;
        color: #fff;
        font-size: 1.1rem;
        letter-spacing: 1px;
        transition: background .2s;
        box-shadow: 0 2px 8px rgba(24,32,255,0.08);
        margin-right: .5em;
    }
    .oishii-btn.orange {
        background: #ff4e42;
        color: #fff;
    }
    .oishii-btn.yellow {
        background: #FFC024;
        color: #000;
    }
    .oishii-btn:disabled {
        background: #e3e3e3;
        color: #aaa;
    }
    .oishii-info {
        background: #FFFCED;
        border-radius: 1em;
        padding: 1em 1.5em;
        margin-bottom: 1em;
        font-size: 1.08rem;
        display: flex;
        align-items: center;
        gap: .7em;
        color: #1820FF;
        font-weight: 600;
    }
    .oishii-info.orange {
        color: #1820FF;
    }
    .oishii-info.yellow {
        background: #FFFCED;
        color: #1820FF;
    }
    .oishii-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        background: #fff;
        border-radius: 1em;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        margin-top: 1em;
    }
    .oishii-table th, .oishii-table td {
        padding: .8em 1em;
        font-size: 1rem;
        border-bottom: 1px solid #FFFCED;
        text-align: center;
    }
    .oishii-table th {
        background: #1820FF;
        color: #fff;
        font-weight: 700;
        letter-spacing: 1px;
    }
    .oishii-table tr:last-child td { border-bottom: none; }
    .oishii-label {
        font-family: 'Rounded Mplus 1c', 'Montserrat', Arial, sans-serif;
        font-weight: 700;
        color: #1820FF;
        margin-bottom: .5em;
        display: block;
    }
    .oishii-checkbox {
        accent-color: #1820FF;
        margin-right: .5em;
    }
    .icon {
        font-size: 1.2em;
        margin-right: .5em;
    }
</style>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">

<div class="oishii-card">
    {% if hobby.image %}
        <img src="{{ hobby.image.url }}" alt="{{ hobby.title }}" style="width:100%; border-radius:1em; margin-bottom:1.5em;">
    {% endif %}
    <div class="oishii-title">{{ hobby.title }}</div>
    <div>
        <span class="oishii-badge orange">{{ hobby.category.name }}</span>
        {% for tag in hobby.tags.all %}
            <span class="oishii-badge">{{ tag.name }}</span>
        {% endfor %}
    </div>
    <p style="font-size:1.15rem; margin:1em 0; color:#222;">{{ hobby.description }}</p>
    <div class="oishii-info"><span class="icon">üë§</span><strong>Host:</strong> {{ hobby.host.username }}</div>
    <div class="oishii-info orange"><span class="icon">üë•</span><strong>Participants:</strong> {{ hobby.get_participant_count }} / {{ hobby.max_participants }}</div>
    <div class="oishii-info"><span class="icon">‚≠ê</span><strong>Host Rating:</strong> {{ hobby.get_average_rating|floatformat:1 }} / 5.0</div>
    <div class="oishii-info yellow"><span class="icon">üìÖ</span><strong>Date & Time:</strong> {{ hobby.date|date:"M d, Y H:i" }}</div>
    <div class="oishii-info"><span class="icon">üìç</span><strong>Place:</strong> {{ hobby.place }}</div>
    {% if user.is_authenticated and not is_host %}
        {% if user_application %}
            <div class="oishii-info">
                <span class="icon">‚úÖ</span>
                <span>Status: <strong>{{ user_application.get_status_display }}</strong></span>
                {% if user_application.status == 'pending' or user_application.status == 'accepted' %}
                    <form method="post" action="{% url 'withdraw_application' hobby.id %}" style="display:inline;">
                        {% csrf_token %}
                        <button type="submit" class="oishii-btn orange">Withdraw</button>
                    </form>
                {% endif %}
            </div>
            <div class="oishii-info orange">
                <span class="icon">‚ÑπÔ∏è</span>
                You have already sent a request to join this hobby.
            </div>
            {% if contact_info %}
                <div class="oishii-info">
                    <span class="icon">üìû</span>
                    Host Contact: {{ contact_info }}
                </div>
            {% endif %}
        {% else %}
            <a href="{% url 'apply_for_hobby' hobby.id %}" class="oishii-btn">Apply to Join</a>
        {% endif %}
    {% endif %}
</div>

<div class="oishii-card">
    <h2 style="color:#FF7A00; font-family:'Rounded Mplus 1c', 'Montserrat', Arial, sans-serif;">Requirements</h2>
    <div style="margin-bottom:1em;">
        {% for req in hobby.requirements.all %}
            <span class="oishii-badge">{{ req.name }}</span>
        {% empty %}
            <span class="oishii-badge orange">No requirements listed.</span>
        {% endfor %}
    </div>
    {% if not is_host %}
    <form method="post">
        {% csrf_token %}
        <span class="oishii-label">Which requirements do you meet?</span>
        <div style="display:flex; flex-wrap:wrap; gap:1em;">
            {% for req in hobby.requirements.all %}
                <label class="oishii-info orange" style="flex:1 1 200px;">
                    <input class="oishii-checkbox" type="checkbox" name="met_requirements" value="{{ req.id }}" {% if req.id in user_met_requirements %}checked{% endif %}>
                    {{ req.name }}
                </label>
            {% endfor %}
        </div>
        <button type="submit" class="oishii-btn mt-2">Save My Requirements</button>
    </form>
    {% endif %}
</div>

{% if is_host %}
<div class="oishii-card">
    <h2 style="color:#1820FF; font-family:'Rounded Mplus 1c', 'Montserrat', Arial, sans-serif;">Who meets each requirement?</h2>
    <table class="oishii-table">
        <thead>
            <tr>
                <th>User</th>
                {% for req in hobby.requirements.all %}
                    <th>{{ req.name }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for username, reqs in user_requirements.items %}
            <tr>
                <td>{{ username }}</td>
                {% for req in hobby.requirements.all %}
                    <td>
                        {% if req.name in reqs %}
                            <span style="color:#1820FF; font-size:1.3em;">&#10003;</span>
                        {% else %}
                            <span style="color:#FF7A00; font-size:1.3em;">&#10007;</span>
                        {% endif %}
                    </td>
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}
{% endblock %}